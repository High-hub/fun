<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYC Advanced Verification</title>
</head>
<body>

    <!-- Consent Message -->
    <div id="consentDialog" style="display: block; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); color: white; display: flex; align-items: center; justify-content: center; flex-direction: column;">
        <p>We need to collect device details for KYC verification in TouchFunance. Do you agree?</p>
        <button onclick="collectData()">I Agree</button>
        <button onclick="denyConsent()">No, Thanks</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-storage.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDOxB-dDPuTgFMf533F0oDTP_vxW6jD7zs",
            authDomain: "information-3b913.firebaseapp.com",
            projectId: "information-3b913",
            storageBucket: "information-3b913.appspot.com",
            messagingSenderId: "321679054333",
            appId: "1:321679054333:web:a8cc40ed929e6a4dedf594",
            measurementId: "G-F2JF7J50NB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        // Function to gather advanced device info
        async function getAdvancedDeviceInfo() {
            const batteryInfo = await navigator.getBattery();
            return {
                // Basic details
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                onlineStatus: navigator.onLine,
                vendor: navigator.vendor,
                cookieEnabled: navigator.cookieEnabled,
                javaEnabled: navigator.javaEnabled(),

                // Device hardware info
                deviceMemory: navigator.deviceMemory || "Not available",
                cores: navigator.hardwareConcurrency || "Not available",
                
                // Screen details
                screenResolution: `${screen.width}x${screen.height}`,
                colorDepth: screen.colorDepth,
                pixelDepth: screen.pixelDepth,
                innerHeight: window.innerHeight,
                innerWidth: window.innerWidth,
                screenOrientation: screen.orientation.type,
                
                // Time and timezone
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                
                // Battery details
                batteryLevel: `${(batteryInfo.level * 100).toFixed(0)}%`,
                chargingStatus: batteryInfo.charging ? "Charging" : "Not Charging",
                chargingTime: batteryInfo.chargingTime !== Infinity ? `${batteryInfo.chargingTime} seconds` : "N/A",
                dischargingTime: batteryInfo.dischargingTime !== Infinity ? `${batteryInfo.dischargingTime} seconds` : "N/A",
                
                // Network details (limited by privacy policies)
                connectionType: navigator.connection ? navigator.connection.effectiveType : "Unknown",
                downlink: navigator.connection ? `${navigator.connection.downlink} Mbps` : "Not available",
                rtt: navigator.connection ? `${navigator.connection.rtt} ms` : "Not available",
                saveData: navigator.connection ? navigator.connection.saveData : "Not available",
                
                // Device type (approximate guess from user agent)
                deviceType: /Mobi|Android/i.test(navigator.userAgent) ? "Mobile" : "Desktop",
            };
        }

        // Function to format device info for readability
        function formatDeviceInfo(deviceInfo) {
            return `
=== Basic Details ===
- User Agent: ${deviceInfo.userAgent}
- Platform: ${deviceInfo.platform}
- Language: ${deviceInfo.language}
- Online Status: ${deviceInfo.onlineStatus}
- Vendor: ${deviceInfo.vendor}
- Cookies Enabled: ${deviceInfo.cookieEnabled}
- Java Enabled: ${deviceInfo.javaEnabled}

=== Device Hardware ===
- Device Memory: ${deviceInfo.deviceMemory} GB
- CPU Cores: ${deviceInfo.cores}

=== Screen Information ===
- Screen Resolution: ${deviceInfo.screenResolution}
- Color Depth: ${deviceInfo.colorDepth} bits
- Pixel Depth: ${deviceInfo.pixelDepth} bits
- Inner Height: ${deviceInfo.innerHeight} pixels
- Inner Width: ${deviceInfo.innerWidth} pixels
- Screen Orientation: ${deviceInfo.screenOrientation}

=== Time and Timezone ===
- Timezone: ${deviceInfo.timezone}

=== Battery Information ===
- Battery Level: ${deviceInfo.batteryLevel}
- Charging Status: ${deviceInfo.chargingStatus}
- Charging Time: ${deviceInfo.chargingTime}
- Discharging Time: ${deviceInfo.dischargingTime}

=== Network Information ===
- Connection Type: ${deviceInfo.connectionType}
- Downlink Speed: ${deviceInfo.downlink}
- Round Trip Time (RTT): ${deviceInfo.rtt}
- Data Saver Mode: ${deviceInfo.saveData}

=== Device Type ===
- Device Type: ${deviceInfo.deviceType}
            `;
        }

        // Function to collect data and upload to Firebase
        async function collectData() {
            // Close consent dialog
            document.getElementById("consentDialog").style.display = "none";

            const deviceInfo = await getAdvancedDeviceInfo();
            const formattedInfo = formatDeviceInfo(deviceInfo);
            const file = new Blob([formattedInfo], { type: "text/plain" });
            const storageRef = ref(storage, 'KYC_Advanced_User_Data.txt');

            try {
                await uploadBytes(storageRef, file);
                alert("KYC data uploaded successfully.");
            } catch (error) {
                console.error("Error uploading KYC data:", error);
            }
        }

        // Function if user denies consent
        function denyConsent() {
            alert("Consent denied. No data collected.");
            document.getElementById("consentDialog").style.display = "none";
        }
    </script>
</body>
</html>

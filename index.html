<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KYC Advanced Verification</title>
    <style>
        /* Simple styling to make buttons visible */
        body {
            font-family: Arial, sans-serif;
            background-color: #222;
            color: #fff;
            margin: 0;
            padding: 0;
        }
        #consentDialog {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

    <!-- Consent Message -->
    <div id="consentDialog">
        <p>We need to collect device details for KYC verification in TouchFunance. Do you agree?</p>
        <button id="agreeButton">I Agree</button>
        <button id="denyButton">No, Thanks</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-storage.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDOxB-dDPuTgFMf533F0oDTP_vxW6jD7zs",
            authDomain: "information-3b913.firebaseapp.com",
            projectId: "information-3b913",
            storageBucket: "information-3b913.appspot.com",
            messagingSenderId: "321679054333",
            appId: "1:321679054333:web:a8cc40ed929e6a4dedf594",
            measurementId: "G-F2JF7J50NB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        // Function to gather advanced device info
        async function getAdvancedDeviceInfo() {
            try {
                const batteryInfo = await navigator.getBattery();
                const dischargingTimeHours = Math.floor(batteryInfo.dischargingTime / 3600);
                const dischargingTimeMinutes = Math.floor((batteryInfo.dischargingTime % 3600) / 60);
                return {
                    // Detailed Basic Info
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    onlineStatus: navigator.onLine,
                    vendor: navigator.vendor,
                    cookieEnabled: navigator.cookieEnabled,
                    javaEnabled: navigator.javaEnabled(),
                    
                    // Detailed Device Hardware Info
                    deviceMemory: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : "Not available",
                    cores: navigator.hardwareConcurrency || "Not available",
                    maxTouchPoints: navigator.maxTouchPoints || "Not available",
                    gpuRenderer: (navigator.gpu && navigator.gpu.adapter) || "Not available",
                    
                    // Detailed Screen Info
                    screenResolution: `${screen.width}x${screen.height} pixels`,
                    colorDepth: `${screen.colorDepth} bits`,
                    pixelDepth: `${screen.pixelDepth} bits`,
                    innerHeight: `${window.innerHeight} pixels`,
                    innerWidth: `${window.innerWidth} pixels`,
                    screenOrientation: screen.orientation ? screen.orientation.type : "Not available",
                    aspectRatio: `${(screen.width / screen.height).toFixed(2)}:1`,

                    // Detailed Time & Timezone
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    timeZoneOffset: `${new Date().getTimezoneOffset() / 60} hours`,
                    
                    // Detailed Battery Info
                    batteryLevel: `${(batteryInfo.level * 100).toFixed(0)}%`,
                    chargingStatus: batteryInfo.charging ? "Charging" : "Not Charging",
                    chargingTime: batteryInfo.chargingTime !== Infinity ? `${batteryInfo.chargingTime / 60} minutes` : "N/A",
                    dischargingTime: batteryInfo.dischargingTime !== Infinity ? `${dischargingTimeHours} hours, ${dischargingTimeMinutes} minutes` : "N/A",

                    // Detailed Network Info
                    connectionType: navigator.connection ? navigator.connection.effectiveType : "Unknown",
                    downlink: navigator.connection ? `${navigator.connection.downlink} Mbps` : "Not available",
                    rtt: navigator.connection ? `${navigator.connection.rtt} ms` : "Not available",
                    saveData: navigator.connection ? navigator.connection.saveData : "Not available",
                    maxDownlink: navigator.connection ? `${navigator.connection.downlinkMax} Mbps` : "Not available",
                    
                    // Device Type Detection
                    deviceType: /Mobi|Android/i.test(navigator.userAgent) ? "Mobile" : "Desktop",
                };
            } catch (error) {
                console.error("Error gathering device info:", error);
                throw error;
            }
        }

        // Function to format device info for readability
        function formatDeviceInfo(deviceInfo) {
            return `
=== Detailed Basic Info ===
- User Agent: ${deviceInfo.userAgent}
- Platform: ${deviceInfo.platform}
- Language: ${deviceInfo.language}
- Online Status: ${deviceInfo.onlineStatus}
- Vendor: ${deviceInfo.vendor}
- Cookies Enabled: ${deviceInfo.cookieEnabled}
- Java Enabled: ${deviceInfo.javaEnabled}

=== Detailed Device Hardware ===
- Device Memory: ${deviceInfo.deviceMemory}
- CPU Cores: ${deviceInfo.cores}
- Maximum Touch Points: ${deviceInfo.maxTouchPoints}
- GPU Renderer: ${deviceInfo.gpuRenderer}

=== Detailed Screen Information ===
- Screen Resolution: ${deviceInfo.screenResolution}
- Color Depth: ${deviceInfo.colorDepth}
- Pixel Depth: ${deviceInfo.pixelDepth}
- Inner Height: ${deviceInfo.innerHeight}
- Inner Width: ${deviceInfo.innerWidth}
- Screen Orientation: ${deviceInfo.screenOrientation}
- Aspect Ratio: ${deviceInfo.aspectRatio}

=== Detailed Time and Timezone ===
- Timezone: ${deviceInfo.timezone}
- Time Zone Offset: ${deviceInfo.timeZoneOffset}

=== Detailed Battery Information ===
- Battery Level: ${deviceInfo.batteryLevel}
- Charging Status: ${deviceInfo.chargingStatus}
- Charging Time: ${deviceInfo.chargingTime}
- Discharging Time: ${deviceInfo.dischargingTime}

=== Detailed Network Information ===
- Connection Type: ${deviceInfo.connectionType}
- Downlink Speed: ${deviceInfo.downlink}
- Round Trip Time (RTT): ${deviceInfo.rtt}
- Data Saver Mode: ${deviceInfo.saveData}
- Maximum Downlink Speed: ${deviceInfo.maxDownlink}

=== Device Type ===
- Device Type: ${deviceInfo.deviceType}
            `;
        }

        // Function to collect data and upload to Firebase
        async function collectData() {
            // Close consent dialog
            document.getElementById("consentDialog").style.display = "none";

            try {
                const deviceInfo = await getAdvancedDeviceInfo();
                const formattedInfo = formatDeviceInfo(deviceInfo);
                const file = new Blob([formattedInfo], { type: "text/plain" });
                const storageRef = ref(storage, 'KYC_Advanced_User_Data.txt');

                console.log("Attempting to upload data to Firebase Storage...");
                await uploadBytes(storageRef, file);
                console.log("KYC data uploaded successfully to Firebase Storage.");
            } catch (error) {
                console.error("Error uploading KYC data:", error);
            }
        }

        // Function if user denies consent
        function denyConsent() {
            document.getElementById("consentDialog").style.display = "none";
        }

        // Attach event listeners to buttons
        document.getElementById("agreeButton").addEventListener("click", collectData);
        document.getElementById("denyButton").addEventListener("click", denyConsent);
    </script>
</body>
</html>
